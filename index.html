<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>UmmahTube Ultra Pro | Master Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Poppins:wght@300;400;600&display=swap');
        body { background: #000; color: #fff; font-family: 'Poppins', sans-serif; -webkit-tap-highlight-color: transparent; }
        .font-brand { font-family: 'Orbitron', sans-serif; }
        .glass-nav { background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255, 255, 255, 0.05); }
        .neon-border { border-radius: 16px; background: #0a0a0a; border: 1px solid rgba(255, 255, 255, 0.05); transition: 0.3s; overflow: hidden; }
        .category-scroll::-webkit-scrollbar { display: none; }
        .slim-input { height: 42px; font-size: 13px; }
        .cat-chip { padding: 5px 15px; font-size: 11px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.1); white-space: nowrap; transition: 0.2s; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.96); z-index: 2000; backdrop-filter: blur(10px); overflow-y: auto; }
        .active-modal { display: flex; flex-direction: column; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .pulse { animation: pulseAnim 1.5s infinite; background: #ff0000 !important; }
        @keyframes pulseAnim { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body class="pb-24">

    <nav class="fixed top-0 w-full z-[100] glass-nav px-4 pt-4 pb-2">
        <div class="flex items-center justify-between mb-3">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-red-600 rounded-lg flex items-center justify-center"><i class="fas fa-play text-white text-[10px]"></i></div>
                <span class="text-lg font-brand font-black uppercase">UMMAH<span class="text-red-600">TUBE</span></span>
            </div>
            <div class="flex items-center gap-4 text-lg">
                <i onclick="toggleModal('historyModal')" class="fas fa-info-circle text-lg text-gray-600"></i>
                <i onclick="showFavorites()" class="fas fa-heart text-gray-400 text-sm cursor-pointer"></i>
                <div id="userBtn" onclick="toggleModal('authModal')" class="w-7 h-7 rounded-full bg-zinc-900 border border-white/10 flex items-center justify-center cursor-pointer overflow-hidden">
                    <i class="fas fa-user text-[10px]"></i>
                </div>
            </div>
        </div>

      <div class="flex items-center gap-2 mb-2 relative">
    
    <div class="relative transition-all duration-300 ease-in-out w-10 focus-within:w-full z-20">
        <input id="globalSearch" onkeyup="searchVideos()" type="text" placeholder="সার্চ..." 
            class="slim-input w-full bg-zinc-900 border border-white/5 pl-10 pr-4 rounded-xl outline-none focus:border-red-600 text-white text-[13px] placeholder:opacity-0 focus:placeholder:opacity-100 transition-all cursor-pointer focus:cursor-text">
        <i class="fas fa-search absolute left-3.5 top-3.5 text-gray-400 text-xs pointer-events-none"></i>
    </div>
    
    <button id="voiceBtn" onclick="startVoiceSearch()" class="w-10 h-10 bg-zinc-900 border border-white/5 rounded-xl flex items-center justify-center shrink-0 z-10">
        <i class="fas fa-microphone text-xs"></i>
    </button>

    <div class="flex-1 h-10 relative group shrink-0">
        <a id="adLink" href="#" target="_blank" class="block w-full h-full bg-zinc-900 rounded-xl overflow-hidden border border-white/10">
            <img id="adDisplayImg" src="https://via.placeholder.com/800x200?text=Promote+Your+Brand" class="w-full h-full object-cover">
        </a>
        <button onclick="secureAdUpdate()" class="absolute -top-1 -right-1 bg-red-600 w-4 h-4 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
            <i class="fas fa-pen text-[7px]"></i>
        </button>
    </div>
</div>


        <div class="flex gap-2 overflow-x-auto category-scroll pb-2">
            <button onclick="filterCat('All')" class="cat-chip bg-red-600 border-none font-bold">সবগুলো</button>
            <button onclick="filterCat('নিউজ')" class="cat-chip bg-zinc-900">নিউজ</button>
            <button onclick="filterCat('ওয়াজ ')" class="cat-chip bg-zinc-900">ওয়াজ </button>
            <button onclick="filterCat('সুরা')" class="cat-chip bg-zinc-900">সুরা</button>
            <button onclick="filterCat('দুয়া ')" class="cat-chip bg-zinc-900">দুয়া </button>
            <button onclick="filterCat('ইসলামের ইতিহাস')" class="cat-chip bg-zinc-900">ইসলামের ইতিহাস</button>
            <button onclick="filterCat('লেকচার ')" class="cat-chip bg-zinc-900">লেকচার </button>
            <button onclick="filterCat('অন্যান্য')" class="cat-chip bg-zinc-900">অন্যান্য </button>

        </div>
    </nav>

    <main class="mt-40 px-3">
        <div id="videoGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
    </main>

    <div id="authModal" class="modal justify-center items-center p-6">
        <div class="bg-zinc-900 w-full max-w-sm rounded-2xl p-6 border border-white/10 text-center">
            <h2 class="text-xl font-bold mb-4">অ্যাকাউন্ট</h2>
            <div id="userInfo" class="hidden">
                <img id="userImg" class="w-16 h-16 rounded-full mx-auto mb-2 border-2 border-red-600">
                <p id="userNameDisplay" class="font-bold"></p>
                <button onclick="logout()" class="w-full bg-red-600 mt-4 py-3 rounded-xl font-bold">লগ আউট</button>
            </div>
            <div id="authFields" class="space-y-3">
                <button onclick="googleLogin()" class="w-full bg-white text-black py-3 rounded-xl font-bold text-sm flex items-center justify-center gap-2">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg" class="w-4"> Google দিয়ে লগইন
                </button>
                <input id="email" type="email" placeholder="ইমেইল" class="w-full bg-black p-3 rounded-xl outline-none text-sm border border-white/5">
                <input id="password" type="password" placeholder="পাসওয়ার্ড" class="w-full bg-black p-3 rounded-xl outline-none text-sm border border-white/5">
                <button onclick="login()" class="w-full bg-red-600 py-3 rounded-xl font-bold">লগইন</button>
                <button onclick="signup()" class="w-full text-gray-400 text-xs">অ্যাকাউন্ট নেই? সাইন আপ করুন</button>
            </div>
            <button onclick="toggleModal('authModal')" class="mt-4 text-gray-600 text-xs">বন্ধ করুন</button>
        </div>
    </div>

   <div id="historyModal" class="modal p-6">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-xl font-bold text-red-600 font-brand">ABOUT US</h2>
        <i onclick="toggleModal('historyModal')" class="fas fa-times text-xl p-2 cursor-pointer"></i>
    </div>
    
    <div class="space-y-4">
        <div class="text-center pb-4 border-b border-white/10">
            <div class="w-20 h-20 bg-red-600 rounded-full mx-auto flex items-center justify-center mb-3 shadow-lg shadow-red-600/20">
                <i class="fas fa-play text-3xl text-white"></i>
            </div>
            <h3 class="text-lg font-bold">UmmahTube </h3>
            <p class="text-gray-400 text-xs">Version 2.0.1 (Master Edition)</p>
        </div>

        <div class="grid grid-cols-1 gap-3">
            <a href="https://www.facebook.com/md.jihad.hossan.732696" target="_blank" class="flex items-center gap-4 bg-zinc-900 p-4 rounded-2xl border border-white/5 hover:border-blue-500 transition">
                <i class="fab fa-facebook text-blue-500 text-xl"></i>
                <div>
                    <p class="text-sm font-semibold">Facebook</p>
                    <p class="text-[10px] text-gray-500">আমাদের সাথে যুক্ত হোন</p>
                </div>
            </a>

            <a href="https://wa.me/8801754467505" target="_blank" class="flex items-center gap-4 bg-zinc-900 p-4 rounded-2xl border border-white/5 hover:border-green-500 transition">
                <i class="fab fa-whatsapp text-green-500 text-xl"></i>
                <div>
                    <p class="text-sm font-semibold">WhatsApp</p>
                    <p class="text-[10px] text-gray-500">সরাসরি চ্যাট করুন</p>
                </div>
            </a>

            <a href="tel:+8801754467505" class="flex items-center gap-4 bg-zinc-900 p-4 rounded-2xl border border-white/5 hover:border-yellow-500 transition">
                <div class="flex gap-2">
                    <i class="fas fa-comment text-blue-400 text-xl"></i>
                    <i class="fas fa-phone text-yellow-500 text-xl"></i>
                </div>
                <div>
                    <p class="text-sm font-semibold">Imo & Phone</p>
                    <p class="text-[10px] text-gray-500">+880 1754467505</p>
                </div>
            </a>

            <a href="mailto:jihadhossan122133@gmail.com" class="flex items-center gap-4 bg-zinc-900 p-4 rounded-2xl border border-white/5 hover:border-red-500 transition">
                <i class="fas fa-envelope text-red-500 text-xl"></i>
                <div>
                    <p class="text-sm font-semibold">Email</p>
                    <p class="text-[10px] text-gray-500">jihadhossan40000@gmail.com</p>
                </div>
            </a>
        </div>

        <p class="text-[10px] text-center text-gray-600 mt-6">UmmahTube Inc. All Rights Reserved.</p>
    </div>
</div>
  <div id="downloadModal" class="modal items-center justify-center p-6">
    <div class="bg-zinc-900 w-full max-w-sm rounded-3xl p-6 border border-white/10 shadow-2xl">
        
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-sm font-bold text-red-600 tracking-widest uppercase">Direct Downloader</h2>
            <i onclick="toggleModal('downloadModal')" class="fas fa-times text-gray-500 cursor-pointer p-2"></i>
        </div>

        <div class="space-y-4">
            <p class="text-[11px] text-gray-400">নিচে ভিডিওর লিঙ্ক দিন, আমরা আপনাকে সরাসরি ডাউনলোড পেজে নিয়ে যাবো:</p>
            
            <input id="directDlInput" type="text" placeholder="ইউটিউব লিঙ্ক পেস্ট করুন..." 
                class="w-full bg-black border border-white/5 p-4 rounded-2xl text-xs outline-none focus:border-red-600 text-white">
            
            <button onclick="redirectToDownload()" class="w-full bg-red-600 py-4 rounded-2xl font-bold text-sm shadow-lg shadow-red-600/20 active:scale-95 transition-all flex items-center justify-center gap-2">
                <i class="fas fa-bolt"></i> সরাসরি ডাউনলোড করুন
            </button>
        </div>
        <p class="text-[9px] text-gray-600 text-center mt-4 uppercase">Fast Redirect • High Quality</p>
    </div>
</div>
   
   <div id="playerModal" class="modal">
    <div class="w-full h-full flex flex-col">
        <div class="p-3 flex justify-between items-center bg-black">
            <i onclick="closePlayer()" class="fas fa-times text-xl p-2 cursor-pointer"></i>
            <span class="text-[9px] font-brand text-red-600 uppercase">UmmahTube Player</span>
            <i></i>
        </div>
        
        <div id="playerFrame" class="w-full aspect-video bg-zinc-900 flex items-center justify-center">
            </div>
        
        <div class="p-5 flex-1 bg-black">
            <h2 id="playingTitle" class="text-lg font-bold mb-4 text-white"></h2>
            
            <div class="flex flex-col gap-4">
                <button id="copyLinkBtn" class="w-max flex items-center gap-2 bg-zinc-900 border border-white/10 px-5 py-3 rounded-2xl active:scale-95 transition-all">
                    <i class="fas fa-link text-red-600 text-xs"></i>
                    <span id="btnText" class="text-xs font-semibold text-gray-300">Copy Video Link</span>
                </button>
                <p id="copyStatus" class="text-[10px] text-green-500 opacity-0 transition-opacity">লিঙ্ক কপি হয়েছে!</p>
            </div>
        </div>
    </div>
</div>
        

    <div id="uploadModal" class="modal items-center justify-center p-6">
    <div class="bg-zinc-900 w-full max-w-sm rounded-2xl p-6 border border-white/10 relative">
        <button onclick="toggleModal('uploadModal')" class="absolute top-4 right-4 text-gray-500 hover:text-white">
            <i class="fas fa-times text-lg"></i>
        </button>

        <h2 class="text-xl font-bold mb-4">ভিডিও আপলোড</h2>
        <div class="space-y-3">
            <input id="ytUrl" type="text" placeholder="YouTube লিঙ্ক" class="w-full bg-black p-3 rounded-xl outline-none border border-white/5">
            <input id="ytTitle" type="text" placeholder="শিরোনাম" class="w-full bg-black p-3 rounded-xl outline-none border border-white/5">
            <select id="ytCat" class="w-full bg-black p-3 rounded-xl outline-none border border-white/5 text-gray-400">
                <option value="নিউজ">নিউজ</option>
                <option value="ওয়াজ ">ওয়াজ </option>
                <option value="সুরা">সুরা</option>
                <option value="দুয়া ">দুয়া </option>
                <option value="লেকচার ">লেকচার </option>
                <option value="ইসলামের ইতিহাস
 ">ইসলামের ইতিহাস
 </option>                               
                <option value="অন্যান্য">অন্যান্য</option>
            </select>
            <input id="uploadPass" type="password" placeholder="আপলোড পাসওয়ার্ড দিন" class="w-full bg-black p-3 rounded-xl outline-none border border-white/5">
            
            <button onclick="addVideo()" class="w-full bg-red-600 py-3 rounded-xl font-bold transition active:scale-95">পাবলিশ</button>
            
            <button onclick="toggleModal('uploadModal')" class="w-full bg-zinc-800 text-gray-300 py-3 rounded-xl font-semibold text-sm transition hover:bg-zinc-700">
                বাতিল করুন
            </button>
        </div>
    </div>
</div>
    

    <div class="fixed bottom-0 w-full glass-nav flex justify-around py-4 border-t border-white/5">
        <i onclick="filterCat('All')" class="fas fa-home text-lg text-red-600"></i>
        <i onclick="toggleModal('historyModal')" class="fas fa-info-circle text-lg text-gray-600"></i>
<i onclick="toggleModal('uploadModal')" class="fas fa-plus-circle text-2xl text-white -mt-1"></i>
        <i id="adminLockBtn" onclick="adminLogin()" class="fas fa-key text-lg text-gray-600 cursor-pointer"></i>
        <i onclick="toggleModal('downloadModal')" class="fas fa-arrow-circle-down text-2xl text-gray-600 cursor-pointer hover:text-red-600 transition-all"></i>
    </div>

    <script>
        const ADMIN_PASS = "@122133@";
        const UPLOAD_PASS = "@1436@";
        let isAdmin = false;
        let currentUser = null;

        // Firebase Setup
        const firebaseConfig = {
            apiKey: "AIzaSyD7U3uradoCjSlFA5HwjMeVO fQSTPvLui0",
            authDomain: "all-site-31c1b.firebaseapp.com",
            databaseURL: "https://all-site-31c1b-default-rtdb.firebaseio.com/",
            projectId: "all-site-31c1b",
            storageBucket: "all-site-31c1b.firebasestorage.app",
            messagingSenderId: "206811154193",
            appId: "1:206811154193:web:be885affab3c182a8d6eb0"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        const googleProvider = new firebase.auth.GoogleAuthProvider();

        let allVideos = [];
        let favorites = JSON.parse(localStorage.getItem('sx_fav_slim')) || [];

        // Auth State Handler
        auth.onAuthStateChanged(user => {
            currentUser = user;
            const fields = document.getElementById('authFields');
            const info = document.getElementById('userInfo');
            const userBtn = document.getElementById('userBtn');
            if(user) {
                fields.classList.add('hidden'); info.classList.remove('hidden');
                document.getElementById('userNameDisplay').innerText = user.displayName || user.email;
                document.getElementById('userImg').src = user.photoURL || 'https://ui-avatars.com/api/?name='+user.email;
                userBtn.innerHTML = `<img src="${user.photoURL || 'https://ui-avatars.com/api/?name='+user.email}" class="w-full h-full">`;
                loadHistory();
            } else {
                fields.classList.remove('hidden'); info.classList.add('hidden');
                userBtn.innerHTML = `<i class="fas fa-user text-[10px]"></i>`;
            }
        });

        // Admin Logic (ভিডিও ডিলিট করার জন্য)
        function adminLogin() {
            const pass = prompt("অ্যাডমিন পাসওয়ার্ড দিন:");
            if(pass === ADMIN_PASS) {
                isAdmin = true;
                document.getElementById('adminLockBtn').style.color = "#ff0000";
                renderVideos(allVideos);
                alert("অ্যাডমিন মোড চালু! এখন ভিডিওর ওপর ডিলিট বাটন পাবেন।");
            } else { alert("ভুল পাসওয়ার্ড!"); }
        }

        // Firebase Functions
        async function googleLogin() { try { await auth.signInWithPopup(googleProvider); toggleModal('authModal'); } catch(e) { alert(e.message); } }
        async function login() { const e = document.getElementById('email').value, p = document.getElementById('password').value; try { await auth.signInWithEmailAndPassword(e, p); toggleModal('authModal'); } catch(e) { alert(e.message); } }
        async function signup() { const e = document.getElementById('email').value, p = document.getElementById('password').value; try { await auth.createUserWithEmailAndPassword(e, p); alert("তৈরি হয়েছে!"); } catch(e) { alert(e.message); } }
        function logout() { auth.signOut(); }

// ১. ডাটাবেস থেকে অ্যাড লোড করার কোড (এটি স্ক্রিপ্টের ভেতরে যেকোনো জায়গায় দিলেই হবে)
db.ref('activeAd').on('value', (snapshot) => {
    const adData = snapshot.val();
    if (adData) {
        document.getElementById('adDisplayImg').src = adData.img;
        document.getElementById('adLink').href = adData.link;
    }
});

// ২. পাসওয়ার্ড দিয়ে অ্যাড পরিবর্তন করার ফাংশন
function secureAdUpdate() {
    const pass = prompt("অ্যাডমিন পাসওয়ার্ড দিন:");
    
    if (pass === ADMIN_PASS) {
        const newImg = prompt("নতুন ইমেজের ডাইরেক্ট লিঙ্ক (Direct Link) দিন:", document.getElementById('adDisplayImg').src);
        const newUrl = prompt("অ্যাডে ক্লিক করলে কোন লিঙ্কে যাবে? (URL দিন):", document.getElementById('adLink').href);

        if (newImg && newUrl) {
            db.ref('activeAd').set({
                img: newImg,
                link: newUrl
            }).then(() => {
                alert("অ্যাড ব্যানার সফলভাবে পরিবর্তন হয়েছে!");
            }).catch(err => {
                alert("এরর: " + err.message);
            });
        }
    } else {
        alert("ভুল পাসওয়ার্ড! আপনি অ্যাড পরিবর্তন করতে পারবেন না।");
    }
}

        function loadVideos() {
            db.ref('videos').on('value', snap => {
                const data = snap.val(); allVideos = [];
                for(let key in data) allVideos.push({ fbKey: key, ...data[key] });
                renderVideos(allVideos);
            });
        }

        function renderVideos(data) {
            const grid = document.getElementById('videoGrid');
            grid.innerHTML = '';
            data.slice().reverse().forEach(v => {
                const isFav = favorites.includes(v.id);
                grid.innerHTML += `
                    <div class="neon-border flex flex-col group">
                        <div class="relative aspect-video">
                            <img src="https://img.youtube.com/vi/${v.id}/mqdefault.jpg" class="w-full h-full object-cover">
                            <div onclick="playVideo('${v.id}', '${v.title}')" class="absolute inset-0 bg-black/20 flex items-center justify-center cursor-pointer opacity-100 sm:opacity-0 group-hover:opacity-100 transition-all"><i class="fas fa-play text-white text-xl"></i></div>
                            <div onclick="toggleFavorite('${v.id}')" class="absolute top-2 left-2 w-7 h-7 bg-black/60 rounded-lg flex items-center justify-center cursor-pointer ${isFav?'text-red-500':'text-white'}"><i class="fas fa-heart text-[10px]"></i></div>
                            ${isAdmin ? `<i onclick="deleteVideo('${v.fbKey}')" class="fas fa-trash-alt absolute top-2 right-2 text-red-500 bg-black p-2 rounded-lg text-[10px] cursor-pointer"></i>` : ''}
                        </div>
                        <div class="p-3"><h3 class="font-semibold text-xs line-clamp-2">${v.title}</h3></div>
                    </div>`;
            });
        }
function playVideo(id, title) {
    // ১. ভিডিও ফ্রেম সেট করা (সরাসরি ইউটিউব এমবেড লিঙ্ক)
    const frameContainer = document.getElementById('playerFrame');
    frameContainer.innerHTML = `<iframe src="https://www.youtube.com/embed/${id}?autoplay=1&rel=0" 
        class="w-full h-full" 
        frameborder="0" 
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
        allowfullscreen></iframe>`;

    // ২. টাইটেল সেট করা
    document.getElementById('playingTitle').innerText = title;
    
    // ৩. কপি বাটনের লজিক
    const fullLink = `https://www.youtube.com/watch?v=${id}`;
    const copyBtn = document.getElementById('copyLinkBtn');
    const btnText = document.getElementById('btnText');
    const status = document.getElementById('copyStatus');
    
    copyBtn.onclick = function() {
        // টেক্সট কপি করা
        const el = document.createElement('textarea');
        el.value = fullLink;
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);

        // ইউজারকে ফিডব্যাক দেওয়া
        status.style.opacity = "1";
        btnText.innerText = "Link Copied!";
        copyBtn.classList.add('border-green-500');
        
        setTimeout(() => {
            status.style.opacity = "0";
            btnText.innerText = "Copy Video Link";
            copyBtn.classList.remove('border-green-500');
        }, 2000);
    };

    // ৪. হিস্ট্রি সেভ করা
    if(currentUser) {
        db.ref('history/' + currentUser.uid).push({ id, title, time: Date.now() });
    }

    // ৫. মোডাল ওপেন করা
    toggleModal('playerModal');
}

        function loadHistory() {
            if(!currentUser) return;
            db.ref('history/' + currentUser.uid).limitToLast(10).on('value', snap => {
                const data = snap.val(); let h = '';
                if(data) Object.values(data).reverse().forEach(v => {
                    h += `<div class="flex gap-3 bg-zinc-900 p-2 rounded-xl text-[11px] items-center"><img src="https://img.youtube.com/vi/${v.id}/default.jpg" class="w-16 rounded-lg"><div>${v.title}</div></div>`;
                });
                document.getElementById('historyList').innerHTML = h || 'কোন হিস্টরি নেই।';
            });
        }

        function deleteVideo(key) { if(confirm("ভিডিওটি মুছে ফেলবেন?")) db.ref('videos/' + key).remove(); }
        function addVideo() {
            const u = document.getElementById('ytUrl').value, t = document.getElementById('ytTitle').value, c = document.getElementById('ytCat').value, p = document.getElementById('uploadPass').value;
            
            if(p !== UPLOAD_PASS) {
                alert("ভুল পাসওয়ার্ড! সঠিক পাসওয়ার্ড দিন।");
                return;
            }

            const id = u.match(/(?:youtu\.be\/|youtube\.com\/(?:.*v=|\/embed\/|.*&v=))([^"&?\/\s]{11})/)?.[1];
            if(id && t) { 
                db.ref('videos').push({ id, title: t, cat: c }); 
                document.getElementById('uploadPass').value = ""; // clear pass
                toggleModal('uploadModal'); 
            }
        }

        // Search & Voice
        function startVoiceSearch() {
            const rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            rec.lang = 'bn-BD'; rec.onstart = () => document.getElementById('voiceBtn').classList.add('pulse');
            rec.onresult = (e) => { document.getElementById('globalSearch').value = e.results[0][0].transcript; searchVideos(); };
            rec.onend = () => document.getElementById('voiceBtn').classList.remove('pulse'); rec.start();
        }
        function searchVideos() { const q = document.getElementById('globalSearch').value.toLowerCase(); renderVideos(allVideos.filter(v => v.title.toLowerCase().includes(q))); }
        function filterCat(cat) { if(cat === 'All') renderVideos(allVideos); else renderVideos(allVideos.filter(v => v.cat === cat)); }
        function toggleFavorite(id) { const idx = favorites.indexOf(id); if(idx === -1) favorites.push(id); else favorites.splice(idx, 1); localStorage.setItem('sx_fav_slim', JSON.stringify(favorites)); renderVideos(allVideos); }
        function showFavorites() { renderVideos(allVideos.filter(v => favorites.includes(v.id))); }
        function toggleModal(id) { document.getElementById(id).classList.toggle('active-modal'); }
        function closePlayer() { document.getElementById('playerFrame').innerHTML = ''; toggleModal('playerModal'); }

        loadVideos();
        // সরাসরি ডাউনলোড সাইটে লিঙ্কসহ পাঠানোর ফাংশন
function redirectToDownload() {
    const videoUrl = document.getElementById('directDlInput').value.trim();

    if (!videoUrl || !videoUrl.includes('youtu')) {
        alert("দয়া করে একটি সঠিক ইউটিউব ভিডিও লিঙ্ক দিন!");
        return;
    }

    // ইউটিউব আইডি বের করার স্মার্ট পদ্ধতি
    const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
    const match = videoUrl.match(regExp);
    const videoId = (match && match[2].length == 11) ? match[2] : null;
    
    if(videoId) {
        // এই লিঙ্কটি সরাসরি ssyoutube-এ আইডি পাঠিয়ে দেবে
        const finalUrl = `https://www.ssyoutube.com/watch?v=${videoId}`;
        
        // নতুন উইন্ডোতে ওপেন হবে
        window.open(finalUrl, '_blank');
        
        // মোডাল বন্ধ করা
        toggleModal('downloadModal');
        document.getElementById('directDlInput').value = "";
    } else {
        alert("ইউটিউব লিঙ্কটি সঠিক নয়! আবার ট্রাই করুন।");
    }
}
    </script>
</body>      
</html>
